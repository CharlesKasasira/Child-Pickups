{% extends 'base.html' %}

{% block content %}

    
    <div class="heading">
        <h1>Register New Parent</h1>
    </div>
    <form id="registration_form" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="first_name">First Name:</label>
        <input type="text" id="first_name" name="first_name" required><br><br>

        <label for="last_name">Last Name:</label>
        <input type="text" id="last_name" name="last_name"><br><br>

        <label for="phone_number">Phone Number:</label>
        <input type="text" id="phone_number" name="phone_number" required><br><br>

        <label for="passport">Passport:</label>
        <input type="file" id="passport" name="passport"><br><br>

        <label for="address">Address:</label>
        <textarea id="address" name="address" rows="4" required></textarea><br><br>

        <label for="gender">Gender:</label>
        <select id="gender" name="gender">
            <option value="male">Male</option>
            <option value="female">Female</option>
        </select><br><br>

        <!-- Webcam display -->
        <video id="video" style="width: 100%; max-width: 400px; margin-bottom: 10px;" autoplay></video><br>
        <canvas id="canvas" style="display: none;"></canvas> <!-- Add a canvas element to capture the image -->
        <img id="captured_image" style="max-width: 400px;"> <!-- Add an img tag to display the captured image -->

        <!-- Replace Face Image input with Capture Face button -->
        <button type="button" onclick="captureFace()" class="btn btn-primary">Capture Face</button><br><br>

        <label for="childs_unique_number">Child's Unique Number:</label>
        <input type="text" id="childs_unique_number" name="childs_unique_number" required><br><br>

        <input type="submit" value="Register Parent" class="btn btn-primary">
    </form>

    <script>
        function captureFace() {
            // Get references to video, canvas, and capture button
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const capturedImage = document.getElementById('captured_image');
    
            // Draw the current frame from the video onto the canvas
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
    
            // Convert the canvas content to a data URL representing a PNG image
            const imageData = canvas.toDataURL('image/png');
    
            // Set the captured image source to display
            capturedImage.src = imageData;
    
            // Create a hidden input element to store the captured image data
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'face_image';
            input.value = imageData;
    
            // Append the hidden input element to the form
            document.getElementById('registration_form').appendChild(input);
        }

        // Request access to the user's webcam
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function (stream) {
                video.srcObject = stream;
            })
            .catch(function (error) {
                console.error('Error accessing webcam:', error);
            });
    </script>
{% endblock %}

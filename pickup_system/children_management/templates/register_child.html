{% extends 'base.html' %}
{% block content %}

<div class="heading">
    <h1>Register New Child</h1>
</div>

<form id="registration_form" method="post" action="{% url 'register_child' %}" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="input-fields">
        <label for="">First Name</label>
        <div>
            <input
            type="text"
            class="form-control"
            placeholder="First Name"
            name="first_name"
            id="first_name"
            minlength="3"
            required
            />
        </div>
    </div>

    <div class="input-fields">
        <label for="">Last Name</label>
        <div>
            <input
            type="text"
            class="form-control"
            placeholder="Last Name"
            name="last_name"
            id="last_name"
            minlength="3"
            required
            />
        </div>
    </div>

    <div class="input-fields">
        <label for="">Gender</label>
        <div>
            <select id="gender" name="gender" class="form-control">
                <option value="male">Male</option>
                <option value="female">Female</option>
            </select>
        </div>
    </div>

    <div class="input-fields">
        <label for="">Birth Certificate</label>
        <div>
            <input type="file" id="birth_certificate" name="birth_certificate" class="form-control">
        </div>
    </div>

    <div class="input-fields">
        <label for="">Child's Unique Number</label>
        <div>
            <input
            type="text"
            class="form-control"
            placeholder="Unique Number"
            name="childs_unique_number"
            id="childs_unique_number"
            minlength="3"
            required
            />
        </div>
    </div>

    <input type="button" onclick="captureFace()" class="btn btn-primary" value="Capture Face" >

    <div class="input-fields">
        <label for="">Classroom Number</label>
        <div>
            <input
            type="text"
            class="form-control"
            placeholder="Classroom Number"
            name="classroom_number"
            id="classroom_number"
            minlength="3"
            required
            />
        </div>
    </div>

    <div class="input-fields">
        <label for="">Block Name</label>
        <div>
            <input
            type="text"
            class="form-control"
            placeholder="Block"
            name="block_name"
            id="block_name"
            required
            />
        </div>
    </div>
    
    <input type="submit" value="Register Child" class="btn btn-primary">
    
</form>

<script>
function captureFace() {
    // Get references to video, canvas, and capture button
    const video = document.createElement('video');
    const canvas = document.createElement('canvas');
    const captureBtn = document.createElement('button');
    captureBtn.textContent = 'Capture Image';

    // Add styles to the video element
    video.style.width = '100%';
    video.style.maxWidth = '400px';
    video.style.marginBottom = '10px';

    // Add event listener to the capture button
    captureBtn.addEventListener('click', function() {
        // Draw the current frame from the video onto the canvas
        const context = canvas.getContext('2d');
        context.drawImage(video, 0, 0, canvas.width, canvas.height);

        // Convert the canvas content to a data URL representing a PNG image
        const imageData = canvas.toDataURL('image/png');

        // Create a hidden input element to store the captured image data
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'face_image';
        input.value = imageData;

        // Append the hidden input element to the form
        document.getElementById('registration_form').appendChild(input);
        
        // Optional: You can append the canvas to the document or perform other actions with it
        document.body.appendChild(canvas);
    });

    // Request access to the user's webcam
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(function(stream) {
            video.srcObject = stream;
        })
        .catch(function(error) {
            console.error('Error accessing webcam:', error);
        });

    // Append the video element and capture button to the form
    document.getElementById('registration_form').appendChild(video);
    document.getElementById('registration_form').appendChild(captureBtn);
}
</script>
{% endblock %}
